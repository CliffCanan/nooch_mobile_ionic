<ion-view view-title="History">

    <ion-nav-buttons side="secondary">
        <button class="button button-clear" ng-click="openFilterChoices()" ng-disabled="filterFlag.length == 0">
            <i class="ion-funnel"></i>
        </button>
    </ion-nav-buttons>

    <ion-content scroll="false">

        <div class="row">
            <div class="col p-t-0">
                <ti-segmented-control>
                    <ti-segmented-control-button ng-click="toggleView('completed')" id="btnCompleted" class="button-positive" title="'Completed'" selected><i class="ion-checkmark-circled"></i>Completed</ti-segmented-control-button>
                    <ti-segmented-control-button ng-click="toggleView('pending')" id="btnPending" class="button-positive" title="'Pending'"><i class="ion-android-time"></i>Pending</ti-segmented-control-button>
                </ti-segmented-control>
            </div>
        </div>

        <div class="list list-inset m-t-0 m-b-10">
            <label class="item item-input searchBarContainer">
                <i class="icon ion-search placeholder-icon p-r-0"></i>
                <input type="search" ng-keyup="checkList()" id="searchBar" ng-model="search" placeholder="Search Payment History">
            </label>
        </div>

        <ion-scroll direction="y" class="history-list" ng-style="historyListHeight">

            <div class="firstTimeWrap" ng-if="isFinishedLoading == true && transactionList.length == 0" ng-style="firstTimeDivHeight">
                <div class="animated slideInDown">
                    <h2>No Payments Yet...</h2>
                    <p>Once you make or receive a payment it will appear here.</p>
                </div>
                <img class="animated bounceInUp" src="././img/HistoryPending.png" />
            </div>

            <ion-list ng-show="transactionList.length > 0 && completed" id="completedView">
                <ion-item class="item item-avatar" ui-sref="app.transferDetails({trans:trans})" ng-repeat="trans in transactionList | filter:search" ng-if="trans.TransactionStatus == 'Success' || trans.TransactionStatus == 'Cancelled' || trans.TransactionStatus == 'Rejected'  ">

                    <img src={{trans.Photo}}>

                    <div class="typeDateContainer">
                        <label class="transTypeLabel sent" ng-if="trans.TransactionType == 'Transfer' && trans.MemberId == memberId">Transfer To</label>
                        <label class="transTypeLabel received" ng-if="trans.TransactionType == 'Transfer' && trans.MemberId != memberId">Transfer From</label>

                        <span ng-if="trans.TransactionType == 'Request' && trans.TransactionStatus == 'Success'">
                            <label class="transTypeLabel sent" ng-if="trans.MemberId != memberId">Paid by</label>
                            <label class="transTypeLabel received" ng-if="trans.MemberId == memberId">Paid To</label>
                        </span>

                        <span ng-if="trans.TransactionType == 'Request' && trans.TransactionStatus == 'Cancelled'">
                            <label class="transTypeLabel sent" ng-if="trans.MemberId != memberId || (trans.MemberId == memberId && trans.MemberId == trans.RecepientId)">Cancelled request to</label>
                            <label class="transTypeLabel received" ng-if="trans.MemberId == memberId && trans.MemberId != trans.RecepientId">Cancelled request by </label>
                        </span>

                        <span ng-if="trans.TransactionType == 'Request' && trans.TransactionStatus == 'Rejected'">
                            <label class="transTypeLabel sent" ng-if="trans.MemberId != memberId || (trans.MemberId == memberId && trans.MemberId == trans.RecepientId)">  Rejected request by</label>
                            <label class="transTypeLabel received" ng-if="trans.MemberId == memberId && trans.MemberId != trans.RecepientId">Rejected request from </label>
                        </span>

                        <span ng-if="trans.TransactionType == 'Transfer'">
                            <label class="transTypeLabel sent" ng-if="trans.MemberId == memberId">Payment To</label>
                            <label class="transTypeLabel received" ng-if="trans.MemberId != memberId">Payment From</label>
                        </span>

                        <span ng-if="trans.TransactionType == 'Invite'">
                            <label class="transTypeLabel sent" ng-if="trans.TransactionStatus == 'Success' && trans.MemberId == memberId">Invite to</label>
                            <label class="transTypeLabel sent" ng-if="trans.TransactionStatus == 'Cancelled' && trans.MemberId != memberId">Invitation To (Cancelled)</label>
                        </span>

                        <span ng-if="trans.TransactionType == 'Reward'">
                            <label class="transTypeLabel received" ng-if="trans.MemberId != memberId">Reward From</label>
                        </span>

                        <span ng-if="trans.TransactionType == 'Rent'">
                            <label class="transTypeLabel received" ng-if="trans.MemberId != memberId">Rent From</label>
                            <label class="transTypeLabel sent" ng-if="trans.MemberId == memberId">Rent to</label>
                        </span>

                        <span ng-if="trans.TransactionType == 'Disputed' && trans.DisputeStatus == 'Resolved'">
                            <label class="transTypeLabel received">Dispute Resolved</label>
                        </span>

                        <h5 class="date"><i class="ion-android-time m-r-5"></i>{{trans.TransactionDate | date : "mediumDate"}}</h5>
                    </div>


                    <div class="name" ng-if="trans.Name.length > 1 && trans.InvitationSentTo == null">{{trans.Name}}</div>
                    <div class="name" ng-if="trans.InvitationSentTo != null">{{trans.InvitationSentTo}}</div>


                    <p class="memo-container" ng-if="trans.Memo != null && trans.Memo != ''">For "<span class="memo-text">{{trans.Memo}}</span>"</p>

                    <span class="item-note amount">{{trans.Amount | currency}}</span>

                    <ion-option-button class="button-positive" ui-sref-ignore ng-click="PayBack(trans)" ng-show="trans.MemberId != memberId && trans.TransactionType == 'Request' && trans.TransactionStatus == 'Success' ">Pay Back </ion-option-button>

                    <ion-option-button class="button-positive" ui-sref-ignore ng-show="(trans.Latitude != 0 && trans.Longitude != 0) && (trans.Latitude != '' && trans.Longitude != '')" ng-click="showMap(trans.Latitude,trans.Longitude)"><i class="ion-ios-location m-10"></i></ion-option-button>

                </ion-item>

                <p class="emptyView">No transactions found!</p>

            </ion-list>

            <ion-list ng-show="transactionList.length > 0 && pending">
                <ion-item class="item item-avatar" ui-sref-active="false" ui-sref="app.transferDetails({trans:trans})" ng-repeat="trans in transactionList | filter:search " ng-if="trans.TransactionStatus == 'Pending'">

                    <img src={{trans.Photo}}>

                    <div class="typeDateContainer" ng-if="trans.TransactionType == 'Transfer'">
                        <label class="transTypeLabel pending" ng-if="trans.MemberId == memberId">Transfer To</label>
                        <label class="transTypeLabel pending" ng-if="trans.MemberId != memberId">Transfer From</label>
                        <h5 class="date"><i class="ion-android-time m-r-5"></i>{{trans.TransactionDate | date : "mediumDate"}}</h5>
                    </div>

                    <div class="typeDateContainer" ng-if="trans.TransactionType == 'Request'">
                        <label class="transTypeLabel pending" ng-if="trans.MemberId == memberId && trans.MemberId!=trans.RecepientId ">Request From</label>
                        <label class="transTypeLabel pending" ng-if="trans.MemberId != memberId || (trans.MemberId == memberId && trans.MemberId==trans.RecepientId)">Request Sent To</label>
                        <h5 class="date"><i class="ion-android-time m-r-5"></i>{{trans.TransactionDate | date :  "mediumDate"}}</h5>
                    </div>

                    <div class="typeDateContainer" ng-if="trans.TransactionType == 'Invite'">
                        <label class="transTypeLabel pending" ng-if="trans.MemberId == memberId">Invite To</label>
                        <label class="transTypeLabel pending" ng-if="trans.MemberId != memberId">Invite From</label>

                        <h5 class="date"><i class="ion-android-time m-r-5"></i>{{trans.TransactionDate | date : "mediumDate"}}</h5>
                    </div>

                    <div class="typeDateContainer" ng-if="trans.TransactionType == 'Rent'">
                        <label class="transTypeLabel pending" ng-if="trans.MemberId != memberId">Rent Request From</label>
                        <label class="transTypeLabel pending" ng-if="trans.MemberId == memberId">Rent Request To</label>
                        <h5 class="date"><i class="ion-android-time m-r-5"></i>{{trans.TransactionDate | date : "mediumDate"}}</h5>
                    </div>

                    <div class="typeDateContainer" ng-if="trans.TransactionType == 'Disputed' && trans.DisputeStatus == 'Under Review'">
                        <label class="transTypeLabel received">Dispute Under Review</label>
                        <h5 class="date"><i class="ion-android-time m-r-5"></i>{{trans.TransactionDate | date : "mediumDate"}}</h5>
                    </div>


                    <div class="name" ng-if="trans.Name.length > 1 && trans.InvitationSentTo.length == null">{{trans.Name}}</div>

                    <div class="name" ng-if="trans.InvitationSentTo.length >= 1">{{trans.InvitationSentTo}}</div>


                    <p class="memo-container" ng-if="trans.Memo != null && trans.Memo != ''">For "<span class="memo-text">{{trans.Memo}}</span>"</p>

                    <span class="item-note amount text-primary">{{ trans.Amount | currency}}</span>

                    <ion-option-button class="button-assertive " ui-sref-ignore ng-click="rejectPayment(trans)" ng-show="trans.MemberId == memberId   && trans.MemberId!=trans.RecepientId && (trans.TransactionType == 'Request' )">Reject</ion-option-button>
                    <ion-option-button class="button-positive" ui-sref-ignore ng-click="TransferMoney(trans)" ng-show="trans.MemberId == memberId  && trans.MemberId!=trans.RecepientId && (trans.TransactionType == 'Request' )">Accept</ion-option-button>
                    <ion-option-button class="button button-assertive " ui-sref-ignore ng-click="cancelPayment(trans)" ng-show="(trans.MemberId != memberId) || (trans.MemberId == memberId && trans.MemberId==trans.RecepientId) && (trans.TransactionType == 'Request' )">Cancel</ion-option-button>
                    <ion-option-button class="button-positive" ui-sref-ignore ng-click="remindPayment(trans)" ng-show="(trans.MemberId != memberId) || (trans.MemberId == memberId && trans.MemberId==trans.RecepientId) && (trans.TransactionType == 'Request' )">Remind</ion-option-button>

                </ion-item>

                <p class="emptyView">No pending transactions found!</p>

            </ion-list>

        </ion-scroll>

    </ion-content>

</ion-view>
